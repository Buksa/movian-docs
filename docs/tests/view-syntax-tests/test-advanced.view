/**
 * Test: Advanced Features
 * 
 * Tests advanced GLW view file features:
 * - Cloner pattern with $self
 * - Event handlers
 * - Loader widget with dynamic loading
 * - Complex property bindings
 * - Advanced layout patterns
 */

container_y {
  spacing = 10;
  
  // Test: Cloner pattern
  list_y {
    spacing = 5;
    
    cloner {
      source = $page.model.items;
      
      container_x {
        spacing = 10;
        focusable = true;
        
        // Test: $self reference in cloner
        image {
          source = $self.icon;
          width = 48;
          height = 48;
        }
        
        container_y {
          label {
            caption = $self.title;
            bold = true;
          }
          
          label {
            caption = $self.description;
            size = 12;
          }
        }
        
        // Test: $clone.index reference
        label {
          caption = "#" + $clone.index;
          size = 10;
        }
      }
    }
  }
  
  // Test: Event handlers
  container_x {
    focusable = true;
    
    // Test: onEvent with activate
    onEvent(activate, navOpen($self.url))
    
    label {
      caption = "Click to open";
    }
  }
  
  container_x {
    focusable = true;
    
    // Test: onEvent with cancel
    onEvent(cancel, deliverEvent($parent.eventSink, "back"))
    
    label {
      caption = "Press back";
    }
  }
  
  // Test: Multiple event handlers
  container_x {
    focusable = true;
    
    onEvent(activate, deliverEvent($parent.eventSink, "select"))
    onEvent(cancel, deliverEvent($parent.eventSink, "cancel"))
    onEvent(focus, deliverEvent($parent.eventSink, "focused"))
    
    label {
      caption = "Multi-event widget";
    }
  }
  
  // Test: Loader widget with dynamic source
  loader {
    source = $page.model.contentView;
    alt = "fallback.view";
    args = $page.model.contentData;
    time = 0.3;
    effect = "blend";
  }
  
  // Test: Loader with conditional source
  loader {
    source = $item.type == "video" ? "video-player.view" : "content.view";
    args = $item;
  }
  
  // Test: Complex property bindings
  container_x {
    // Bidirectional binding
    width <- $model.containerWidth;
    height <- $model.containerHeight;
    
    // Conditional binding
    alpha = $model.enabled && $model.visible ? 1.0 : 0.3;
    
    // Multi-level property chain
    color = $page.model.theme.colors.primary;
  }
  
  // Test: Advanced cloner with filtering
  list_y {
    cloner {
      source = $page.model.items;
      
      container_x {
        // Only show if item is enabled
        hidden = !$self.enabled;
        
        // Conditional styling based on item state
        alpha = $self.selected ? 1.0 : 0.7;
        color = $self.selected ? $ui.color.selected : $ui.color.normal;
        
        label {
          caption = $self.title;
          bold = $self.selected;
        }
      }
    }
  }
  
  // Test: Nested loaders
  container_y {
    loader {
      source = "header.view";
      args = $page.model.header;
    }
    
    loader {
      source = $page.model.contentType == "list" ? "list-view.view" : "grid-view.view";
      args = $page.model.content;
    }
    
    loader {
      source = "footer.view";
      args = $page.model.footer;
    }
  }
  
  // Test: Complex layout with multiple features
  container_z {
    // Background layer
    image {
      source = $page.model.background;
      alpha = 0.3;
    }
    
    // Content layer
    container_y {
      spacing = 10;
      padding = 20;
      
      // Dynamic header
      label {
        caption = $page.model.title ?? "Untitled";
        size = 24;
        bold = true;
        color = $ui.color.text;
      }
      
      // Scrollable content
      list_y {
        cloner {
          source = $page.model.items;
          
          container_x {
            focusable = true;
            spacing = 10;
            
            onEvent(activate, navOpen($self.url))
            
            // Item icon
            image {
              source = $self.icon ?? "default-icon.png";
              width = 64;
              height = 64;
            }
            
            // Item details
            container_y {
              spacing = 3;
              
              label {
                caption = $self.title;
                bold = true;
                size = 16;
              }
              
              label {
                caption = $self.subtitle ?? "";
                size = 12;
                color = $ui.color.subtitle;
              }
              
              label {
                caption = $self.metadata.duration ?? "";
                size = 10;
                color = $ui.color.metadata;
              }
            }
            
            // Status indicator
            quad {
              width = 10;
              height = 10;
              color = $self.watched ? "#00FF00" : "#FF0000";
              alpha = 0.8;
            }
          }
        }
      }
    }
    
    // Overlay layer
    container_z {
      hidden = !$page.model.showOverlay;
      
      quad {
        color = "#000000";
        alpha = 0.7;
      }
      
      container_y {
        align = "center";
        
        label {
          caption = $page.model.overlayMessage;
          size = 18;
          color = "#FFFFFF";
        }
      }
    }
  }
}
