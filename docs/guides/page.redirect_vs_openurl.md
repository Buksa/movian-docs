# üìö –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ Movian: –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-11-20  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

## üìñ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏](#-–¥–≤–∞-—Å–ø–æ—Å–æ–±–∞-–Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [API Reference](#-api-reference)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#-–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- [–ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#-–ø—Ä–∞–≤–∏–ª–∞-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#-—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)
- [–í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ](#-–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)
- [–ß–µ–∫–ª–∏—Å—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞](#-—á–µ–∫–ª–∏—Å—Ç-–¥–ª—è-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞)
- [–ó–∞–∫–ª—é—á–µ–Ω–∏–µ](#-–∑–∞–∫–ª—é—á–µ–Ω–∏–µ)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–æ–±–ª–µ–º–∞

```javascript
// ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ò—Å—Ç–æ—Ä–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
page.redirect("myapp:video:123");
// –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ù–∞–∑–∞–¥" –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
```

### –†–µ—à–µ–Ω–∏–µ

```javascript
// ‚úÖ –†–ï–®–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ navigation.openUrl()
var navigation = require('./lib/navigation');
navigation.openUrl("myapp:video:123");
// –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ù–∞–∑–∞–¥" –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
```

---

## üìä –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

### –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ú–µ—Ç–æ–¥ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ò—Å—Ç–æ—Ä–∏—è | –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-------|-----------|---------|----------------|-------------------|
| **`page.redirect(url)`** | –ó–∞–º–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã | ‚ùå –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç | ‚ùå –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç | –†–µ–¥–∏—Ä–µ–∫—Ç—ã, –æ—à–∏–±–∫–∏ |
| **`navigation.openUrl(url)`** | –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤–ø–µ—Ä—ë–¥ | ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç | ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç | –ü–µ—Ä–µ—Ö–æ–¥—ã, –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ |

### –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

```
üìç redirect - –ó–∞–º–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
[–ì–ª–∞–≤–Ω–∞—è] ‚Üí [–ê–Ω–∏–º–µ] ‚Üí redirect ‚Üí [–ü–ª–µ–µ—Ä]
                ‚îî‚îÄ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∞
–ù–∞–∑–∞–¥: [–ü–ª–µ–µ—Ä] ‚Üí [–ì–ª–∞–≤–Ω–∞—è] ‚ùå (–ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ –ê–Ω–∏–º–µ)

üìç openUrl - –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤–ø–µ—Ä—ë–¥:
[–ì–ª–∞–≤–Ω–∞—è] ‚Üí [–ê–Ω–∏–º–µ] ‚Üí openUrl ‚Üí [–ü–ª–µ–µ—Ä]
            ‚îî‚îÄ –≤ –∏—Å—Ç–æ—Ä–∏–∏
–ù–∞–∑–∞–¥: [–ü–ª–µ–µ—Ä] ‚Üí [–ê–Ω–∏–º–µ] ‚Üí [–ì–ª–∞–≤–Ω–∞—è] ‚úÖ
```

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å `lib/navigation.js`

```javascript
/**
 * navigation.js - Helper –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤ Movian
 * 
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç navigator.eventSink –≤–º–µ—Å—Ç–æ page.eventSink
 * –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
 */

var prop = require('movian/prop');

/**
 * –ü–æ–ª—É—á–∏—Ç—å eventSink –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–∞
 * @returns {Object|null} Navigator eventSink –∏–ª–∏ null
 */
function getNavigatorEventSink() {
  try {
    var navigators = prop.global.navigators;
    if (!navigators) {
      console.error('[NAV] prop.global.navigators not found');
      return null;
    }
    
    // –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤—ã–π navigator —á–µ—Ä–µ–∑ nodes[0]
    if (navigators.nodes) {
      var nav = navigators.nodes[0];
      if (nav && nav.eventSink) {
        return nav.eventSink;
      }
    }
    
    console.error('[NAV] navigator.eventSink not found');
    return null;
  } catch (e) {
    console.error('[NAV] Error getting navigator eventSink:', e);
    return null;
  }
}

/**
 * –û—Ç–∫—Ä—ã—Ç—å URL —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
 * 
 * @param {string} url - URL –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è
 * @param {Object} options - –û–ø—Ü–∏–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
 * @param {string} options.view - –¢–∏–ø –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (video, directory, etc)
 * @param {string} options.how - –°–ø–æ—Å–æ–± –æ—Ç–∫—Ä—ã—Ç–∏—è (newTab, newPage, etc)
 * @param {string} options.parenturl - URL —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
 * @returns {boolean} true –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ, false –µ—Å–ª–∏ –æ—à–∏–±–∫–∞
 * 
 * @example
 * // –ü—Ä–æ—Å—Ç–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
 * navigation.openUrl("myapp:video:123");
 * 
 * @example
 * // –° –æ–ø—Ü–∏—è–º–∏
 * navigation.openUrl("myapp:video:123", {
 *   view: "video",
 *   parenturl: "myapp:list"
 * });
 */
function openUrl(url, options) {
  options = options || {};
  
  var eventSink = getNavigatorEventSink();
  if (!eventSink) {
    console.error('[NAV] Cannot open URL: navigator eventSink not found');
    return false;
  }
  
  var args = { url: url };
  if (options.view) args.view = options.view;
  if (options.how) args.how = options.how;
  if (options.parenturl) args.parenturl = options.parenturl;
  
  try {
    prop.sendEvent(eventSink, "openurl", args);
    console.log('[NAV] Opened URL:', url);
    return true;
  } catch (e) {
    console.error('[NAV] Error sending openurl event:', e);
    return false;
  }
}

// –≠–∫—Å–ø–æ—Ä—Ç
exports.getNavigatorEventSink = getNavigatorEventSink;
exports.openUrl = openUrl;
```

### –®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ

```javascript
// –í –ª—é–±–æ–º —Ñ–∞–π–ª–µ –ø–ª–∞–≥–∏–Ω–∞
var navigation = require('./lib/navigation');

// –û—Ç–∫—Ä—ã—Ç—å URL
navigation.openUrl("myapp:page:123");
```

---

## üìö API Reference

### `navigation.openUrl(url, options)`

–û—Ç–∫—Ä—ã–≤–∞–µ—Ç URL —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `url` | string | ‚úÖ –î–∞ | URL –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è |
| `options` | object | ‚ùå –ù–µ—Ç | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ |
| `options.view` | string | ‚ùå –ù–µ—Ç | –¢–∏–ø –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (video, directory) |
| `options.how` | string | ‚ùå –ù–µ—Ç | –°–ø–æ—Å–æ–± –æ—Ç–∫—Ä—ã—Ç–∏—è (newTab, newPage) |
| `options.parenturl` | string | ‚ùå –ù–µ—Ç | URL —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã |

#### –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç

`boolean` - `true` –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ, `false` –µ—Å–ª–∏ –æ—à–∏–±–∫–∞

#### –ü—Ä–∏–º–µ—Ä—ã

```javascript
// –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π
navigation.openUrl("myapp:video:123");

// –° —Ç–∏–ø–æ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
navigation.openUrl("myapp:video:123", { view: "video" });

// –û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
navigation.openUrl("myapp:settings", { how: "newTab" });

// –° –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Ä–æ–¥–∏—Ç–µ–ª—è
navigation.openUrl("myapp:episode:5", {
  parenturl: "myapp:season:2"
});
```

---

### `navigation.getNavigatorEventSink()`

–ü–æ–ª—É—á–∏—Ç—å eventSink –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–∞ (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ).

#### –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç

`Object|null` - Navigator eventSink –∏–ª–∏ null –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω

#### –ü—Ä–∏–º–µ—Ä

```javascript
var eventSink = navigation.getNavigatorEventSink();
if (eventSink) {
  prop.sendEvent(eventSink, "openurl", { url: "..." });
}
```

---

## üíº –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

```javascript
var popup = require('native/popup');
var navigation = require('./lib/navigation');

function findLastWatched(items) {
  var lastWatched = null;
  
  for (var i = 0; i < items.length; i++) {
    var item = items[i];
    var playcount = item.root.playcount ? item.root.playcount.valueOf() : 0;
    
    if (playcount > 0) {
      lastWatched = {
        index: i,
        title: item.root.metadata.title.valueOf(),
        url: item.root.url.valueOf()
      };
    }
  }
  
  return lastWatched;
}

function resumePlayback(page, items) {
  setTimeout(function() {
    var lastWatched = findLastWatched(items);
    if (!lastWatched) return;
    
    var message = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä?\n"' + lastWatched.title + '"';
    
    if (popup.message(message, true, true)) {
      // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º openUrl –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
      navigation.openUrl(lastWatched.url);
    }
  }, 1000);
}

new page.Route(/^myapp:series:(.*)$/, function(page, id) {
  page.type = 'directory';
  page.metadata.title = '–≠–ø–∏–∑–æ–¥—ã';
  
  // ... –∑–∞–≥—Ä—É–∑–∫–∞ —ç–ø–∏–∑–æ–¥–æ–≤ –≤ items ...
  
  resumePlayback(page, items);
  
  page.loading = false;
});
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–µ—Ä–∏–π
2. –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–π —ç–ø–∏–∑–æ–¥
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è popup "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä?"
4. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–î–∞" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —ç–ø–∏–∑–æ–¥ —á–µ—Ä–µ–∑ `openUrl` ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é
5. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ù–∞–∑–∞–¥" ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–µ—Ä–∏–π ‚úÖ

---

### –ü—Ä–∏–º–µ—Ä 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```javascript
var navigation = require('./lib/navigation');

new page.Route(/^myapp:premium:(.*)$/, function(page, contentId) {
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  if (!isLoggedIn()) {
    // ‚ùå redirect - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–µ–º–∏—É–º –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é
    page.redirect("myapp:login?return=myapp:premium:" + contentId);
    return;
  }
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–º–∏—É–º –∫–æ–Ω—Ç–µ–Ω—Ç
  page.type = 'video';
  page.source = getPremiumVideo(contentId);
  page.loading = false;
});

new page.Route(/^myapp:login$/, function(page) {
  page.type = 'directory';
  page.metadata.title = '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è';
  
  page.appendAction("–í–æ–π—Ç–∏", function() {
    if (login(username, password)) {
      // ‚úÖ openUrl - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫ –∫–æ–Ω—Ç–µ–Ω—Ç—É —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏
      var returnUrl = getQueryParam('return') || 'myapp:home';
      navigation.openUrl(returnUrl);
    }
  });
  
  page.loading = false;
});
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–µ–º–∏—É–º –∫–æ–Ω—Ç–µ–Ω—Ç
2. –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí `redirect` –Ω–∞ –ª–æ–≥–∏–Ω (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–µ–º–∏—É–º –Ω–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏)
3. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞ ‚Üí `openUrl` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–µ–º–∏—É–º –∫–æ–Ω—Ç–µ–Ω—Ç (–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é)
4. –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞ ‚úÖ

---

### –ü—Ä–∏–º–µ—Ä 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

```javascript
var navigation = require('./lib/navigation');

new page.Route(/^myapp:player:(.*)$/, function(page, videoId) {
  var video = getVideo(videoId);
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
  if (!video) {
    // ‚ùå redirect –Ω–∞ –æ—à–∏–±–∫—É (–Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é)
    page.redirect("myapp:error404");
    return;
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
  if (!hasAccess(video)) {
    // ‚ùå redirect –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥–ø–∏—Å–∫–∏
    page.redirect("myapp:subscribe?return=myapp:player:" + videoId);
    return;
  }
  
  page.type = 'video';
  page.source = video.url;
  page.metadata.title = video.title;
  page.loading = false;
});
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ
2. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Üí `redirect` –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—à–∏–±–∫–∏ (–Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é)
3. –ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ ‚Üí `redirect` –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥–ø–∏—Å–∫–∏ (–Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é)
4. –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, –º–∏–Ω—É—è –æ—à–∏–±–∫–∏ ‚úÖ

---

## üîß –ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `navigation.openUrl()` –∫–æ–≥–¥–∞

#### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –∫–æ–Ω—Ç–µ–Ω—Ç—É

```javascript
// –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ø–∏–∑–æ–¥–∞
if (shouldResume) {
  navigation.openUrl(lastEpisode.url); // ‚úÖ
}
```

#### 2. –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤–ø–µ—Ä—ë–¥ –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É

```javascript
// –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞–∑–¥–µ–ª—É –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è
page.appendAction("–°–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª", function() {
  navigation.openUrl(nextSection.url); // ‚úÖ
});
```

#### 3. –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```javascript
// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞
if (loginSuccess) {
  navigation.openUrl(returnUrl); // ‚úÖ
}
```

---

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `page.redirect()` –∫–æ–≥–¥–∞

#### 1. –†–µ–¥–∏—Ä–µ–∫—Ç –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

```javascript
// –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
if (!isLoggedIn()) {
  page.redirect("myapp:login"); // ‚úÖ
  return;
}

// –ö–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
if (!contentExists) {
  page.redirect("myapp:error404"); // ‚úÖ
  return;
}
```

#### 2. –û–∫–æ–Ω—á–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

```javascript
// –ü–ª–µ–π–ª–∏—Å—Ç –∑–∞–∫–æ–Ω—á–∏–ª—Å—è - –≤–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É
if (!hasNextVideo) {
  page.redirect("myapp:playlist"); // ‚úÖ
}
```

---

## üéØ –ü—Ä–∞–≤–∏–ª–æ –±–æ–ª—å—à–æ–≥–æ –ø–∞–ª—å—Ü–∞

> **–°–ø—Ä–æ—Å–∏—Ç–µ —Å–µ–±—è:** *"–î–æ–ª–∂–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–Ω–æ–ø–∫–æ–π '–ù–∞–∑–∞–¥'?"*
>
> - **–î–ê** ‚Üí `navigation.openUrl()`
> - **–ù–ï–¢** ‚Üí `page.redirect()`

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "–ù–∞–∑–∞–¥" –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–°–∏–º–ø—Ç–æ–º—ã:**

```
–û—Ç–∫—Ä—ã–ª–∏: –ì–ª–∞–≤–Ω–∞—è ‚Üí –°–ø–∏—Å–æ–∫ ‚Üí –î–µ—Ç–∞–ª–∏ ‚Üí –ü–ª–µ–µ—Ä
"–ù–∞–∑–∞–¥": –í–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ –∑–∞–≥–ª–∞–≤–Ω—É—é (–ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ –î–µ—Ç–∞–ª–∏) ‚ùå
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `page.redirect()` –≤–º–µ—Å—Ç–æ `navigation.openUrl()`

**–†–µ—à–µ–Ω–∏–µ:**

```javascript
// ‚ùå –ë—ã–ª–æ
page.redirect(details.url);

// ‚úÖ –°—Ç–∞–ª–æ
navigation.openUrl(details.url);
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "navigator eventSink not found"

**–°–∏–º–ø—Ç–æ–º—ã:**

```
[NAV] Error: navigator.eventSink not found
```

**–ü—Ä–∏—á–∏–Ω–∞:**

- Navigator –µ—â—ë –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- –í—ã–∑–æ–≤ —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ (–¥–æ –∑–∞–ø—É—Å–∫–∞ UI)

**–†–µ—à–µ–Ω–∏–µ:**

```javascript
// –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∏ fallback
var success = navigation.openUrl(url);
if (!success) {
  console.log("Fallback to redirect");
  page.redirect(url);
}
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**

```
[NAV] Opened URL: myapp:test
// –ù–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
```

**–ü—Ä–∏—á–∏–Ω–∞:**

- –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–ª—è —ç—Ç–æ–≥–æ URL (Route –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω)
- –û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ Route

**–†–µ—à–µ–Ω–∏–µ:**

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Route —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
new page.Route(/^myapp:test$/, function(page) {
  console.log("Route handler called"); // –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥
  page.type = 'directory';
  page.loading = false;
});
```

---

## üî¨ –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç page.redirect() - –ø–æ–¥—Ä–æ–±–Ω–æ

**–®–∞–≥ 1: –í—ã–∑–æ–≤ –∏–∑ JavaScript**

```javascript
// –í –ø–ª–∞–≥–∏–Ω–µ
page.redirect("myapp:newpage");
```

**–®–∞–≥ 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –≤ C**

```javascript
// page.js:348
prop.sendEvent(this.root.eventSink, "redirect", url);
// –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç EVENT_REDIRECT –≤ page.root.eventSink
```

**–®–∞–≥ 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ page_eventsink (navigator.c:620)**

```c
if(event_is_type(e, EVENT_REDIRECT)) {
  const event_payload_t *ep = (const event_payload_t *)e;
  page_redirect(np, ep->payload);
}
```

**–®–∞–≥ 4: –§—É–Ω–∫—Ü–∏—è page_redirect –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É**

```c
static void page_redirect(nav_page_t *np, const char *url)
{
  // np - —ç—Ç–æ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –°–£–©–ï–°–¢–í–£–Æ–©–£–Æ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –∏—Å—Ç–æ—Ä–∏–∏
  
  page_unsub(np);              // –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —Å–æ–±—ã—Ç–∏–π —Å—Ç–∞—Ä–æ–≥–æ URL
  prop_destroy_childs(...);     // –û—á–∏—Å—Ç–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
  mystrset(&np->np_url, url);   // –ó–ê–ú–ï–ù–ò–¢–¨ URL –Ω–∞ –Ω–æ–≤—ã–π
  nav_page_setup_prop(np, ...); // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞
  nav_open_backend(np);         // –û—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
  
  // np->np_history_link –ù–ï –ò–ó–ú–ï–ù–Ø–ï–¢–°–Ø!
  // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ —Ç–æ–º –∂–µ –º–µ—Å—Ç–µ –∏—Å—Ç–æ—Ä–∏–∏
}
```

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:**

```c
// –ò—Å—Ç–æ—Ä–∏—è –î–û redirect:
// [–ì–ª–∞–≤–Ω–∞—è] ‚Üí [–°–ø–∏—Å–æ–∫] ‚Üí [–î–µ—Ç–∞–ª–∏(current)]
//                            ^
//                            np —É–∫–∞–∑—ã–≤–∞–µ—Ç —Å—é–¥–∞

page_redirect(np, "myapp:error");

// –ò—Å—Ç–æ—Ä–∏—è –ü–û–°–õ–ï redirect:
// [–ì–ª–∞–≤–Ω–∞—è] ‚Üí [–°–ø–∏—Å–æ–∫] ‚Üí [–û—à–∏–±–∫–∞(current)]
//                            ^
//                            —Ç–æ—Ç –∂–µ np, –Ω–æ —Å –Ω–æ–≤—ã–º URL!

// TAILQ_INSERT_TAIL –ù–ï –í–´–ó–´–í–ê–ï–¢–°–Ø!
// –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ nav_history –ù–ï –°–û–ó–î–ê–Å–¢–°–Ø!
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ù–∞–∑–∞–¥" –ø–æ—Å–ª–µ redirect:**

–ò–∑ `navigator.c`, —Ñ—É–Ω–∫—Ü–∏—è `nav_back` (—Å—Ç—Ä–æ–∫–∞ 796):

```c
static void
nav_back(navigator_t *nav)
{
  nav_page_t *prev, *np = nav->nav_page_current;
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ –∏—Å—Ç–æ—Ä–∏–∏
  if(np != NULL &&
     (prev = TAILQ_PREV(np, nav_page_queue, np_history_link)) != NULL) {
    
    // –ï—Å—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –Ω–µ—ë
    nav_select(nav, prev, NULL);
    
    if(doclose)
      nav_close(np, 1);
      
  } else {
    // –ù–ï–¢ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å ACTION_SYSTEM_HOME
    event_t *e = event_create_action(ACTION_SYSTEM_HOME);
    prop_t *eventsink = prop_create_r(nav->nav_prop_root, "eventSink");
    prop_send_ext_event(eventsink, e);
    prop_ref_dec(eventsink);
    event_release(e);
  }
}
```

**–ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è:**

```c
// –ò—Å—Ö–æ–¥–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è:
// [Home] ‚Üí [List] ‚Üí [Details(current)]

page_redirect(np, "myapp:error");

// –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ redirect (Details –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ Error):
// [Home] ‚Üí [List] ‚Üí [Error(current)]

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞–∑–∞–¥":
nav_back(nav);
// prev = TAILQ_PREV(np, ...) // prev = List
// nav_select(nav, prev, NULL); // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ List ‚úÖ

// –ò—Å—Ç–æ—Ä–∏—è:
// [Home] ‚Üí [List(current)] ‚Üí [Error]

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞–∑–∞–¥" –µ—â—ë —Ä–∞–∑:
nav_back(nav);
// prev = TAILQ_PREV(np, ...) // prev = Home
// nav_select(nav, prev, NULL); // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Home ‚úÖ

// –ò—Å—Ç–æ—Ä–∏—è:
// [Home(current)] ‚Üí [List] ‚Üí [Error]

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞–∑–∞–¥" –µ—â—ë —Ä–∞–∑:
nav_back(nav);
// prev = TAILQ_PREV(np, ...) // prev = NULL (–Ω–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π)
// event_create_action(ACTION_SYSTEM_HOME); // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è "–î–æ–º–æ–π" ‚úÖ
```

**–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞ —á–µ—Ä–µ–∑ `redirect` –∏ —è–≤–ª—è–µ—Ç—Å—è –ü–ï–†–í–û–ô –≤ –∏—Å—Ç–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏), —Ç–æ –Ω–∞–∂–∞—Ç–∏–µ "–ù–∞–∑–∞–¥" –æ—Ç–ø—Ä–∞–≤–∏—Ç `ACTION_SYSTEM_HOME` - –≤–æ–∑–≤—Ä–∞—Ç –∫ –≥–ª–∞–≤–Ω–æ–º—É —ç–∫—Ä–∞–Ω—É —Å–∏—Å—Ç–µ–º—ã Movian.

---

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç navigation.openUrl() - –ø–æ–¥—Ä–æ–±–Ω–æ

**–®–∞–≥ 1: –í—ã–∑–æ–≤ –∏–∑ JavaScript**

```javascript
// –í –ø–ª–∞–≥–∏–Ω–µ
navigation.openUrl("myapp:newpage");
```

**–®–∞–≥ 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –≤ navigator**

```javascript
// lib/navigation.js
var eventSink = prop.global.navigators.nodes[0].eventSink;
prop.sendEvent(eventSink, "openurl", { url: url });
// –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç EVENT_OPENURL –≤ navigator.eventSink
```

**–®–∞–≥ 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ nav_eventsink (navigator.c:936)**

```c
if(event_is_type(e, EVENT_OPENURL)) {
  ou = (event_openurl_t *)e;
  if(ou->url != NULL)
    nav_open0(nav, ou->url, ...);
}
```

**–®–∞–≥ 4: –§—É–Ω–∫—Ü–∏—è nav_open0 —Å–æ–∑–¥–∞—ë—Ç –ù–û–í–£–Æ —Å—Ç—Ä–∞–Ω–∏—Ü—É**

```c
static void nav_open0(navigator_t *nav, const char *url, ...)
{
  // –°–æ–∑–¥–∞—Ç—å –ù–û–í–£–Æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  nav_page_t *np = calloc(1, sizeof(nav_page_t));
  np->np_url = strdup(url);
  
  nav_page_setup_prop(np, view);
  
  // –î–û–ë–ê–í–ò–¢–¨ –≤ –∏—Å—Ç–æ—Ä–∏—é
  nav_insert_page(nav, np, item_model);
  
  nav_open_backend(np);
}
```

**–®–∞–≥ 5: –§—É–Ω–∫—Ü–∏—è nav_insert_page –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é**

```c
static void nav_insert_page(navigator_t *nav, nav_page_t *np, ...)
{
  // –£–¥–∞–ª–∏—Ç—å "–±—É–¥—É—â—É—é" –∏—Å—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –µ—Å—Ç—å
  while((np2 = TAILQ_NEXT(nav->nav_page_current, ...)) != NULL)
    nav_close(np2, 1);
  
  // –î–û–ë–ê–í–ò–¢–¨ –í –ö–û–ù–ï–¶ –ò–°–¢–û–†–ò–ò
  TAILQ_INSERT_TAIL(&nav->nav_history, np, np_history_link);
  
  nav_select(nav, np, item_model);
}
```

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:**

```c
// –ò—Å—Ç–æ—Ä–∏—è –î–û openUrl:
// [–ì–ª–∞–≤–Ω–∞—è] ‚Üí [–°–ø–∏—Å–æ–∫] ‚Üí [–î–µ—Ç–∞–ª–∏(current)]

nav_open0(nav, "myapp:player");

// –ò—Å—Ç–æ—Ä–∏—è –ü–û–°–õ–ï openUrl:
// [–ì–ª–∞–≤–Ω–∞—è] ‚Üí [–°–ø–∏—Å–æ–∫] ‚Üí [–î–µ—Ç–∞–ª–∏] ‚Üí [–ü–ª–µ–µ—Ä(current)]
//                                      ^
//                                      –Ω–æ–≤–∞—è np!

// TAILQ_INSERT_TAIL –í–´–ó–´–í–ê–ï–¢–°–Ø!
// –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ nav_history –°–û–ó–î–ê–Å–¢–°–Ø!
```

---

### –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö

```
üìç redirect - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

–î–æ:  nav_history: [A] ‚Üí [B] ‚Üí [C(current)]
                               ^
                               np->np_url = "page:c"

redirect("page:error"):
     nav_history: [A] ‚Üí [B] ‚Üí [C(current)]
                               ^
                               np->np_url = "page:error" (–∏–∑–º–µ–Ω—ë–Ω!)

–ù–∞–∑–∞–¥: [A] ‚Üí [B] (–∏—Å—Ç–æ—Ä–∏—è —Å–æ–∫—Ä–∞—Ç–∏–ª–∞—Å—å –Ω–∞ 1 —ç–ª–µ–º–µ–Ω—Ç)
–ï—â—ë –ù–∞–∑–∞–¥: [A] (—Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
–ï—â—ë –ù–∞–∑–∞–¥: ACTION_SYSTEM_HOME (–≤–æ–∑–≤—Ä–∞—Ç –∫ –≥–ª–∞–≤–Ω–æ–º—É —ç–∫—Ä–∞–Ω—É Movian) üè†


üìç –û—Å–æ–±—ã–π —Å–ª—É—á–∞–π - redirect –Ω–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ:

–î–æ:  nav_history: [StartPage(current)]
                  ^
                  np->np_url = "myapp:start"

redirect("myapp:error"):
     nav_history: [ErrorPage(current)]
                  ^
                  np->np_url = "myapp:error" (–∏–∑–º–µ–Ω—ë–Ω!)

–ù–∞–∑–∞–¥: prev = NULL ‚Üí ACTION_SYSTEM_HOME (—Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—Ç –∫ Movian Home) üè†


üìç openUrl - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

–î–æ:  nav_history: [A] ‚Üí [B] ‚Üí [C(current)]

openUrl("page:d"):
     nav_history: [A] ‚Üí [B] ‚Üí [C] ‚Üí [D(current)]
                                     ^
                                     –Ω–æ–≤–∞—è np!

–ù–∞–∑–∞–¥: [A] ‚Üí [B] ‚Üí [C] ‚Üí [D]
                    ^
                    –≤–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ C
–ï—â—ë –ù–∞–∑–∞–¥: [A] ‚Üí [B] (—Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
–ï—â—ë –ù–∞–∑–∞–¥: [A] (—Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
–ï—â—ë –ù–∞–∑–∞–¥: ACTION_SYSTEM_HOME (–≤–æ–∑–≤—Ä–∞—Ç –∫ –≥–ª–∞–≤–Ω–æ–º—É —ç–∫—Ä–∞–Ω—É Movian) üè†
```

---

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏–π

```
JavaScript                    C (Movian Core)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ navigation.js   ‚îÇ          ‚îÇ   navigator.c    ‚îÇ
‚îÇ                 ‚îÇ          ‚îÇ                  ‚îÇ
‚îÇ openUrl(url) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄsendEvent‚îÄ‚îÄ‚Üí nav_eventsink()
‚îÇ                 ‚îÇ          ‚îÇ         ‚îÇ        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ         ‚ñº        ‚îÇ
                             ‚îÇ   nav_open0()    ‚îÇ
                             ‚îÇ         ‚îÇ        ‚îÇ
                             ‚îÇ         ‚ñº        ‚îÇ
                             ‚îÇ  nav_insert_page()‚îÇ
                             ‚îÇ         ‚îÇ        ‚îÇ
                             ‚îÇ         ‚ñº        ‚îÇ
                             ‚îÇ   [–ò—Å—Ç–æ—Ä–∏—è]      ‚îÇ
                             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ prop.global –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤

–ò–∑ `navigator.c`, —Å—Ç—Ä–æ–∫–∞ 250:

```c
nav->nav_prop_root = prop_create(all_navigators, NULL);

nav->nav_prop_pages       = prop_create(nav->nav_prop_root, "pages");
nav->nav_prop_curpage     = prop_create(nav->nav_prop_root, "currentpage");
nav->nav_prop_can_go_back = prop_create(nav->nav_prop_root, "canGoBack");
nav->nav_prop_can_go_fwd  = prop_create(nav->nav_prop_root, "canGoForward");
nav->nav_prop_can_go_home = prop_create(nav->nav_prop_root, "canGoHome");
prop_t *eventsink         = prop_create(nav->nav_prop_root, "eventSink");
```

–í JavaScript —ç—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ –∫–∞–∫:

```javascript
prop.global.navigators.nodes[0] = {
  pages: ...,
  currentpage: ...,
  canGoBack: ...,
  canGoForward: ...,
  canGoHome: ...,
  eventSink: ...  // ‚Üê –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è openurl
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è openurl

–ò–∑ `navigator.c`, —Ñ—É–Ω–∫—Ü–∏—è `nav_eventsink` (—Å—Ç—Ä–æ–∫–∞ 916):

```c
} else if(event_is_type(e, EVENT_OPENURL)) {
  ou = (event_openurl_t *)e;
  if(ou->url != NULL)
    nav_open0(nav, ou->url, ou->view,
              ou->item_model, ou->parent_model,
              ou->how, ou->parent_url);
```

–§—É–Ω–∫—Ü–∏—è `nav_open0` —Å–æ–∑–¥–∞—ë—Ç **–Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É**:

```c
nav_page_t *np = calloc(1, sizeof(nav_page_t));
np->np_url = strdup(url);
// ...
nav_insert_page(nav, np, item_model);
```

–§—É–Ω–∫—Ü–∏—è `nav_insert_page` –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é (—Å—Ç—Ä–æ–∫–∞ 477):

```c
TAILQ_INSERT_TAIL(&nav->nav_history, np, np_history_link);
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è redirect

–ò–∑ `navigator.c`, —Ñ—É–Ω–∫—Ü–∏—è `page_eventsink` (—Å—Ç—Ä–æ–∫–∞ 615):

```c
} else if(event_is_type(e, EVENT_REDIRECT)) {
  const event_payload_t *ep = (const event_payload_t *)e;
  page_redirect(np, ep->payload);
}
```

–§—É–Ω–∫—Ü–∏—è `page_redirect` **–∏–∑–º–µ–Ω—è–µ—Ç —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É** (—Å—Ç—Ä–æ–∫–∞ 881):

```c
static void
page_redirect(nav_page_t *np, const char *url)
{
  navigator_t *nav = np->np_nav;
  
  TRACE(TRACE_DEBUG, "navigator", "Following redirect to %s", url);
  
  // 1. –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  page_unsub(np);
  
  // 2. –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞
  prop_destroy_childs(np->np_prop_root);
  
  // 3. –ò–∑–º–µ–Ω–∏—Ç—å URL —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  mystrset(&np->np_url, url);
  
  // 4. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  nav_page_setup_prop(np, NULL);
  
  // 5. –û—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤ —Ç–æ–π –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  nav_open_backend(np);
}
```

**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ:**

- `openurl` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `nav_open0` ‚Üí —Å–æ–∑–¥–∞—ë—Ç **–Ω–æ–≤—É—é nav_page_t** ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
- `redirect` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `page_redirect` ‚Üí **–∏–∑–º–µ–Ω—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é nav_page_t** ‚Üí –ù–ï –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é

### –í—ã–∑–æ–≤ –∏–∑ JavaScript

**page.redirect()** –≤ `page.js` (—Å—Ç—Ä–æ–∫–∞ 341):

```javascript
Page.prototype.redirect = function(url) {
  // 1. –£–¥–∞–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É–∑–ª–æ–≤
  Core.resourceDestroy(this.nodesub);
  
  if(this.sync) {
    // –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º - –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ backend
    require('native/route').backendOpen(this.root, url, true);
  } else {
    // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ EVENT_REDIRECT
    prop.sendEvent(this.root.eventSink, "redirect", url);
  }
}
```

**–ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

```
JavaScript                     C (Movian Core)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ page.redirect()  ‚îÇ          ‚îÇ                      ‚îÇ
‚îÇ       ‚îÇ          ‚îÇ          ‚îÇ                      ‚îÇ
‚îÇ       ‚ñº          ‚îÇ          ‚îÇ                      ‚îÇ
‚îÇ sendEvent() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí  ‚îÇ page_eventsink()    ‚îÇ
‚îÇ   "redirect"     ‚îÇ          ‚îÇ       ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ       ‚ñº              ‚îÇ
                              ‚îÇ page_redirect()      ‚îÇ
                              ‚îÇ  ‚îú‚îÄ page_unsub()     ‚îÇ
                              ‚îÇ  ‚îú‚îÄ destroy_childs() ‚îÇ
                              ‚îÇ  ‚îú‚îÄ mystrset(url)    ‚îÇ
                              ‚îÇ  ‚îî‚îÄ nav_open_backend()‚îÇ
                              ‚îÇ                      ‚îÇ
                              ‚îÇ [–¢–∞ –∂–µ nav_page_t]   ‚îÇ
                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### ‚úÖ –ü–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º –ø–ª–∞–≥–∏–Ω–∞

- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `lib/navigation.js`
- [ ] –í—Å–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `navigation.openUrl()`
- [ ] –†–µ–¥–∏—Ä–µ–∫—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `page.redirect()`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –Ω–∞ –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–∞—Ö
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- [ ] –ò—Å—Ç–æ—Ä–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ª–æ–≥–∏—á–Ω–∞ –∏ —É–¥–æ–±–Ω–∞

### ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

1. **–¢–µ—Å—Ç –ø—Ä—è–º–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:**
   - –ì–ª–∞–≤–Ω–∞—è ‚Üí –†–∞–∑–¥–µ–ª ‚Üí –î–µ—Ç–∞–ª–∏ ‚Üí –ö–æ–Ω—Ç–µ–Ω—Ç
   - –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è? ‚úÖ

2. **–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥":**
   - –ö–æ–Ω—Ç–µ–Ω—Ç ‚Üí "–ù–∞–∑–∞–¥" ‚Üí –î–µ—Ç–∞–ª–∏
   - –î–µ—Ç–∞–ª–∏ ‚Üí "–ù–∞–∑–∞–¥" ‚Üí –†–∞–∑–¥–µ–ª
   - –†–∞–∑–¥–µ–ª ‚Üí "–ù–∞–∑–∞–¥" ‚Üí –ì–ª–∞–≤–Ω–∞—è
   - –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã? ‚úÖ

3. **–¢–µ—Å—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤:**
   - –û—à–∏–±–∫–∞ ‚Üí –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é
   - "–ù–∞–∑–∞–¥" –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞ –æ—à–∏–±–∫—É? ‚úÖ

4. **–¢–µ—Å—Ç –∞–≤—Ç–æ–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è:**
   - –û—Ç–∫—Ä—ã—Ç—å —Å–µ—Ä–∏—é ‚Üí Popup "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?"
   - –î–∞ ‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —ç–ø–∏–∑–æ–¥
   - "–ù–∞–∑–∞–¥" ‚Üí –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å–µ—Ä–∏—é? ‚úÖ

---

## üéì –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

1. **–î–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `navigation.openUrl()`** - —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏
2. **–î–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `page.redirect()`** - –∫–æ–≥–¥–∞ –∏—Å—Ç–æ—Ä–∏—è –Ω–µ –Ω—É–∂–Ω–∞
3. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π eventSink** - `prop.global.navigators.nodes[0].eventSink`
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"** - –≥–ª–∞–≤–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

### –ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞

```javascript
// –ù–∞–≤–∏–≥–∞—Ü–∏—è - –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
navigation.openUrl(url);

// –†–µ–¥–∏—Ä–µ–∫—Ç - –∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É
page.redirect(url);
```

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-20  
**–ò—Å—Ç–æ—á–Ω–∏–∫–∏:** navigator.c, event.c, es_prop.c –∏–∑ Movian  
**–õ–∏—Ü–µ–Ω–∑–∏—è:** MIT
