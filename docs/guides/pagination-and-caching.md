# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞: –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Movian

## –í–≤–µ–¥–µ–Ω–∏–µ

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ —Å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤ Movian. –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –æ–ø—ã—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞–≥–∏–Ω–∞ Anilibria.tv.

**–î–≤–∞ –ø–æ–¥—Ö–æ–¥–∞ –∫ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—é:**
1. **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π HTTP –∫—ç—à Movian** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) - –ø—Ä–æ—Å—Ç–æ–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π
2. **Custom –∫—ç—à** (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π) - –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–ª–æ—è–º–∏

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
2. [–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π HTTP –∫—ç—à Movian (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)](#–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π-http-–∫—ç—à-movian-—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
3. [Custom –∫—ç—à (–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)](#custom-–∫—ç—à-–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)
4. [–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤](#—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ-–ø–æ–¥—Ö–æ–¥–æ–≤)
5. [–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è](#–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è-–ø–∞–≥–∏–Ω–∞—Ü–∏—è)
6. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫—ç—à–∞ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-–∫—ç—à–∞-–∏-–ø–∞–≥–∏–Ω–∞—Ü–∏–∏)
7. [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏](#–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏)
8. [–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏](#—Ç–∏–ø–∏—á–Ω—ã–µ-–æ—à–∏–±–∫–∏)
9. [–ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞](#–ø—Ä–∏–º–µ—Ä—ã-–∫–æ–¥–∞)

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

```javascript
var page = require('movian/page');

new page.Route('myplugin:catalog', function(page) {
  page.type = "directory";
  
  var currentPage = 1;
  
  function loader() {
    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    loadData(currentPage, function(error, items) {
      if (error) {
        page.haveMore(false);
        return;
      }
      
      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
      items.forEach(function(item) {
        page.appendItem(item.url, 'video', {
          title: item.title
        });
      });
      
      // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞
      currentPage++;
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      page.haveMore(!items.endOfData);
    });
  }
  
  // –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤
  loader();
  
  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–≥–∏–Ω–∞—Ç–æ—Ä–∞
  page.asyncPaginator = loader;
});
```

---

## –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π HTTP –∫—ç—à Movian (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –û–±–∑–æ—Ä

Movian –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π HTTP –∫—ç—à, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫—ç—à–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã. –≠—Ç–æ **—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥** –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø–ª–∞–≥–∏–Ω–æ–≤.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–º–∏–Ω–∏–º—É–º –∫–æ–¥–∞)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ Movian
- ‚úÖ –ù–∞–¥—ë–∂–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–ª—É—á–∞–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∫—ç—à

```javascript
var http = require('movian/http');

http.request(url, {
  method: 'GET',
  headers: config.HEADERS,
  caching: true,           // ‚úÖ –í–∫–ª—é—á–∏—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∫—ç—à
  cacheTime: 300000        // –í—Ä–µ–º—è –∫—ç—à–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (5 –º–∏–Ω—É—Ç)
}, function(error, response) {
  // ‚úÖ –ö–õ–Æ–ß–ï–í–û–ô –ú–û–ú–ï–ù–¢: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  // response.statuscode === 0 –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ—Ç–≤–µ—Ç –∏–∑ –∫—ç—à–∞
  // response.statuscode === 200 –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ—Ç–≤–µ—Ç –∏–∑ HTTP
  
  if (response.statuscode === 0) {
    console.log('Response from Movian cache');
  }
});
```

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:** Movian –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `statuscode === 0` –¥–ª—è –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:

```javascript
var isFromCache = (response.statuscode === 0);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
if (response.statuscode !== 200 && response.statuscode !== 0) {
  // –û—à–∏–±–∫–∞ HTTP
  callback(new Error('HTTP ' + response.statuscode), null);
  return;
}

// –ü–µ—Ä–µ–¥–∞—á–∞ —Ñ–ª–∞–≥–∞ fromCache
callback(null, data, isFromCache);
```

**–ó–Ω–∞—á–µ–Ω–∏—è statuscode:**
- `200` - —Å–≤–µ–∂–∏–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
- `0` - –æ—Ç–≤–µ—Ç –∏–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –∫—ç—à–∞ Movian
- –î—Ä—É–≥–∏–µ - –æ—à–∏–±–∫–∞ HTTP

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∫—ç—à–µ–º

**–§–∞–π–ª: `lib/loaders/catalog.js`**

```javascript
var http = require('movian/http');
var catalogDomain = require('../domain/catalog');

function createCatalogLoader(config) {
  return {
    load: function(pageNum, callback) {
      // –í–∞–ª–∏–¥–∞—Ü–∏—è
      if (!pageNum || typeof pageNum !== 'number' || pageNum < 1) {
        callback(new Error('Invalid page number'), null);
        return;
      }
      
      // –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ URL
      var apiUrl = config.API.API_URL + '/anime/catalog/releases';
      var queryParams = {
        limit: config.UI.PAGE_SIZE,
        'f[sorting]': 'FRESH_AT_DESC',
        page: pageNum
      };
      
      var queryParts = [];
      for (var key in queryParams) {
        if (queryParams.hasOwnProperty(key)) {
          queryParts.push(
            encodeURIComponent(key) + '=' + 
            encodeURIComponent(queryParams[key])
          );
        }
      }
      var requestUrl = apiUrl + '?' + queryParts.join('&');
      
      console.log('[CATALOG] Request URL:', requestUrl);
      
      // ‚úÖ HTTP –∑–∞–ø—Ä–æ—Å —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∫—ç—à–µ–º Movian
      http.request(requestUrl, {
        method: 'GET',
        headers: config.HEADERS,
        caching: true,
        cacheTime: config.CACHE.DURATION
      }, function(error, response) {
        if (error) {
          console.log('[CATALOG] HTTP error:', error);
          callback(error, null);
          return;
        }
        
        console.log('[CATALOG] HTTP status:', response.statuscode);
        
        // ‚úÖ –ö–õ–Æ–ß–ï–í–û–ô –ú–û–ú–ï–ù–¢: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        var isFromCache = (response.statuscode === 0);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
        if (response.statuscode !== 200 && response.statuscode !== 0) {
          callback(new Error('HTTP ' + response.statuscode), null);
          return;
        }
        
        if (isFromCache) {
          console.log('[CATALOG] Response from Movian cache');
        }
        
        // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞
        try {
          var data = JSON.parse(response.toString());
          
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ domain layer
          var result = catalogDomain.processCatalogData(data, {
            prefix: config.PREFIX,
            coverBaseUrl: config.API.COVER_URL,
            pageSize: config.UI.PAGE_SIZE
          });
          
          // ‚úÖ –í–æ–∑–≤—Ä–∞—Ç —Å —Ñ–ª–∞–≥–æ–º fromCache
          var responseObj = {
            items: result,
            fromCache: isFromCache  // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∏–∑ statuscode
          };
          
          console.log('[CATALOG] Loaded', result.length, 'items, fromCache:', isFromCache);
          callback(null, responseObj);
        } catch (parseError) {
          console.log('[CATALOG] Parse error:', parseError);
          callback(parseError, null);
        }
      });
    }
  };
}

module.exports = { createCatalogLoader: createCatalogLoader };
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –∫—ç—à–∞

**–§–∞–π–ª: `lib/config.js`**

```javascript
module.exports = {
  CACHE: {
    ENABLED: true,
    DURATION: 300000,      // 5 –º–∏–Ω—É—Ç (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∫—ç—à Movian)
  }
};
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ routes.js

**–§–∞–π–ª: `lib/routes.js`**

```javascript
var globalApiClient = createApiClient();

function handleStartPage(page) {
  setupPageMetadata(page, {
    title: 'Anilibria.tv',
    type: 'directory',
    loading: true,
    model: 'movies'
  });

  var currentPage = 1;
  page.flush();

  function loader() {
    log.d('[ROUTES] Loading catalog page: ' + currentPage);
    
    globalApiClient.getCatalog(currentPage, function(error, result) {
      page.loading = false;
      
      if (error) {
        log.e('[ROUTES] Failed to load catalog page ' + currentPage);
        ui.createSeparator(page, '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
        page.haveMore(false);
        return;
      }
      
      var items = result.items;
      var fromCache = result.fromCache;  // ‚úÖ –§–ª–∞–≥ –∏–∑ loader
      
      log.d('[ROUTES] Loaded ' + items.length + ' items');
      log.d('[ROUTES] fromCache: ' + fromCache);
      
      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
      ui.renderCatalogItems(page, items);
      
      currentPage++;
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
      if (items.endOfData) {
        page.haveMore(false);
      } else {
        page.haveMore(true);
        
        // ‚úÖ –ö–õ–Æ–ß–ï–í–û–ô –ú–û–ú–ï–ù–¢: –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫—ç—à–∞
        if (fromCache && currentPage <= 3) {
          log.d('[ROUTES] Auto-loading page ' + currentPage + ' from cache');
          setTimeout(loader, 10);
        }
      }
    });
  }

  // –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤
  loader();
  
  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–≥–∏–Ω–∞—Ç–æ—Ä–∞
  page.asyncPaginator = loader;
}
```

### –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü–µ—Ä–≤–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ (–±–µ–∑ –∫—ç—à–∞):**
```
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 ‚Üí HTTP 200 ‚Üí fromCache=false ‚Üí –ù–ï–¢ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫—Ä–æ–ª–ª–∏—Ç ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 2 (HTTP 200)
```

**–í–æ–∑–≤—Ä–∞—Ç (—Å –∫—ç—à–µ–º):**
```
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 ‚Üí HTTP 0 (–∫—ç—à) ‚Üí fromCache=true ‚Üí –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã 2
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 2 ‚Üí HTTP 0 (–∫—ç—à) ‚Üí fromCache=true ‚Üí –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã 3
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 3 ‚Üí HTTP 0 (–∫—ç—à) ‚Üí fromCache=true ‚Üí –°—Ç–æ–ø (currentPage > 3)
–†–µ–∑—É–ª—å—Ç–∞—Ç: 60 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–º–µ—Å—Ç–æ 20 ‚úÖ
```

---

## Custom –∫—ç—à (–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)

### –û–±–∑–æ—Ä

Custom –∫—ç—à - —ç—Ç–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –Ω–∞–¥ —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã–º–∏.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∫—ç—à–µ–º
- ‚úÖ –ú–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–µ —Ç–æ–ª—å–∫–æ HTTP)
- ‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–ª–æ—è–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –ö–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è (LRU, LFU, TTL)
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –ë–æ–ª—å—à–µ –∫–æ–¥–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- ‚ùå –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é
- ‚ùå –ù—É–∂–Ω–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –æ—á–∏—Å—Ç–∫—É

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —á–∞—Å—Ç—è–º–∏ –ø–ª–∞–≥–∏–Ω–∞
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ-HTTP –¥–∞–Ω–Ω—ã—Ö (–≤—ã—á–∏—Å–ª–µ–Ω–∏—è, —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è
- –ù—É–∂–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### üí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Custom Cache –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–ª–æ—è–º–∏

Custom –∫—ç—à –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –¥–ª—è HTTP –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ –∏ –∫–∞–∫ **–º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö** –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–ª–æ—è–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

1. **–ü–µ—Ä–µ–¥–∞—á–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏:**
```javascript
// –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–ø–∏—Å–∫–∞ - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
cache.set('anime:' + animeId + ':metadata', {
  title: anime.title,
  poster: anime.poster,
  description: anime.description,
  episodes: anime.episodes
});

// –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–ª–µ–µ—Ä–∞ - –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
var metadata = cache.get('anime:' + animeId + ':metadata');
if (metadata) {
  page.metadata.title = metadata.title;
  page.metadata.icon = metadata.poster;
}
```

2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏:**
```javascript
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
cache.set('playback:position:' + videoId, {
  position: currentTime,
  duration: totalDuration,
  timestamp: Date.now()
}, 86400000); // 24 —á–∞—Å–∞

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
var savedPosition = cache.get('playback:position:' + videoId);
if (savedPosition && savedPosition.position > 0) {
  player.seek(savedPosition.position);
}
```

3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π:**
```javascript
// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
function getProcessedAnimeList(rawData) {
  var cacheKey = 'processed:anime:' + rawData.page;
  var cached = cache.get(cacheKey);
  
  if (cached) {
    return cached;
  }
  
  // –¢—è–∂—ë–ª–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  var processed = rawData.items.map(function(item) {
    return {
      // ... —Å–ª–æ–∂–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ...
    };
  });
  
  cache.set(cacheKey, processed, 600000); // 10 –º–∏–Ω—É—Ç
  return processed;
}
```

4. **–ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É route handlers:**
```javascript
// –í route handler —Å–ø–∏—Å–∫–∞
new page.Route('plugin:anime:list', function(page) {
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
  cache.set('filters:current', {
    genre: selectedGenre,
    year: selectedYear,
    sorting: selectedSorting
  });
});

// –í route handler –¥–µ—Ç–∞–ª–µ–π
new page.Route('plugin:anime:details:(.*)', function(page, id) {
  // –ü–æ–ª—É—á–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É"
  var filters = cache.get('filters:current');
  if (filters) {
    page.appendAction('–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É', function() {
      navigation.openUrl('plugin:anime:list?' + buildQuery(filters));
    });
  }
});
```

5. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ API —Ç–æ–∫–µ–Ω–æ–≤ –∏ —Å–µ—Å—Å–∏–π:**
```javascript
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
function login(username, password, callback) {
  api.authenticate(username, password, function(error, token) {
    if (!error && token) {
      cache.set('auth:token', token, 3600000); // 1 —á–∞—Å
      cache.set('auth:username', username);
    }
    callback(error, token);
  });
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
function makeAuthenticatedRequest(url, callback) {
  var token = cache.get('auth:token');
  if (!token) {
    callback(new Error('Not authenticated'), null);
    return;
  }
  
  http.request(url, {
    headers: { 'Authorization': 'Bearer ' + token }
  }, callback);
}
```

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö:**
- –ù–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –ò–∑–±–µ–≥–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
- –£–ª—É—á—à–∞–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è Custom Cache

**–§–∞–π–ª: `lib/cache.js`**

```javascript
var config = require('./config');

var cacheStorage = {
  entries: {},
  stats: { hits: 0, misses: 0, size: 0 }
};

/**
 * –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞
 */
function get(key, maxAge) {
  if (!config.CACHE.ENABLED || !key) {
    return null;
  }
  
  var entry = cacheStorage.entries[key];
  
  if (!entry) {
    cacheStorage.stats.misses++;
    return null;
  }
  
  var age = Date.now() - entry.timestamp;
  var maxAgeToUse = maxAge !== undefined ? maxAge : config.CACHE.DURATION;
  
  if (age > maxAgeToUse) {
    remove(key);
    cacheStorage.stats.misses++;
    return null;
  }
  
  entry.lastAccess = Date.now();
  cacheStorage.stats.hits++;
  return entry.data;
}

/**
 * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –∫—ç—à
 */
function set(key, data, maxAge) {
  if (!config.CACHE.ENABLED || !key) {
    return;
  }
  
  var now = Date.now();
  var isNew = !cacheStorage.entries[key];
  
  cacheStorage.entries[key] = {
    data: data,
    timestamp: now,
    lastAccess: now,
    maxAge: maxAge || config.CACHE.DURATION
  };
  
  if (isNew) {
    cacheStorage.stats.size++;
  }
  
  // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
  if (cacheStorage.stats.size >= config.CACHE.MAX_ENTRIES) {
    removeLeastRecentlyUsed();
  }
}

/**
 * –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å
 */
function remove(key) {
  if (cacheStorage.entries[key]) {
    delete cacheStorage.entries[key];
    cacheStorage.stats.size--;
  }
}

/**
 * –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫—ç—à
 */
function clear() {
  cacheStorage.entries = {};
  cacheStorage.stats.size = 0;
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
 */
function getStats() {
  var total = cacheStorage.stats.hits + cacheStorage.stats.misses;
  var hitRate = total > 0 ? (cacheStorage.stats.hits / total * 100).toFixed(2) : 0;
  
  return {
    size: cacheStorage.stats.size,
    maxSize: config.CACHE.MAX_ENTRIES,
    hits: cacheStorage.stats.hits,
    misses: cacheStorage.stats.misses,
    hitRate: hitRate + '%',
    enabled: config.CACHE.ENABLED
  };
}

/**
 * LRU –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ
 */
function removeLeastRecentlyUsed() {
  var oldestKey = null;
  var oldestAccess = Date.now();
  
  for (var key in cacheStorage.entries) {
    var entry = cacheStorage.entries[key];
    if (entry.lastAccess < oldestAccess) {
      oldestAccess = entry.lastAccess;
      oldestKey = key;
    }
  }
  
  if (oldestKey) {
    remove(oldestKey);
  }
}

module.exports = {
  get: get,
  set: set,
  remove: remove,
  clear: clear,
  getStats: getStats
};
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Custom Cache

**–§–∞–π–ª: `lib/config.js`**

```javascript
module.exports = {
  CACHE: {
    ENABLED: true,
    DURATION: 300000,      // 5 –º–∏–Ω—É—Ç
    MAX_ENTRIES: 100,      // –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø–∏—Å–µ–π
    CLEANUP_THRESHOLD: 0.9 // –ü–æ—Ä–æ–≥ –æ—á–∏—Å—Ç–∫–∏
  }
};
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Custom Cache –≤ API

**–§–∞–π–ª: `lib/api.js`**

```javascript
var http = require('movian/http');
var cache = require('./cache');
var config = require('./config');

var apiClient = {
  /**
   * HTTP –∑–∞–ø—Ä–æ—Å —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
   */
  request: function(url, options, callback) {
    var useCache = options.useCache !== false;
    var cacheMaxAge = options.cacheMaxAge || config.CACHE.DURATION;
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –∫—ç—à–∞
    var cacheKey = url + (options.postdata ? ':' + JSON.stringify(options.postdata) : '');
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
    if (useCache && config.CACHE.ENABLED) {
      var cachedData = cache.get(cacheKey, cacheMaxAge);
      if (cachedData !== null) {
        // –í–æ–∑–≤—Ä–∞—Ç –∏–∑ –∫—ç—à–∞ —Å —Ñ–ª–∞–≥–æ–º
        setTimeout(function() {
          callback(null, cachedData, true);  // fromCache = true
        }, 0);
        return;
      }
    }
    
    // HTTP –∑–∞–ø—Ä–æ—Å
    http.request(url, options, function(error, response) {
      if (error) {
        callback(error, null, false);
        return;
      }
      
      if (response.statuscode !== 200) {
        callback(new Error('HTTP ' + response.statuscode), null, false);
        return;
      }
      
      try {
        var data = JSON.parse(response.toString());
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à
        if (useCache && config.CACHE.ENABLED) {
          cache.set(cacheKey, data);
        }
        
        callback(null, data, false);  // fromCache = false
      } catch (parseError) {
        callback(parseError, null, false);
      }
    });
  },
  
  /**
   * –ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
   */
  getCatalog: function(pageNum, callback) {
    var url = 'https://api.example.com/catalog?page=' + pageNum;
    
    this.request(url, {
      useCache: true,
      cacheMaxAge: 300000  // 5 –º–∏–Ω—É—Ç
    }, function(error, data, fromCache) {
      if (error) {
        callback(error, null, false);
        return;
      }
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
      var items = processData(data);
      callback(null, items, fromCache);
    });
  }
};

module.exports = apiClient;
```

---

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

### –¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π HTTP –∫—ç—à | Custom –∫—ç—à |
|----------|---------------------|------------|
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** | ‚≠ê –ü—Ä–æ—Å—Ç–æ–π | ‚≠ê‚≠ê‚≠ê –°–ª–æ–∂–Ω—ã–π |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞** | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π | –ú–Ω–æ–≥–æ –∫–æ–¥–∞ |
| **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ | –†—É—á–Ω–æ–µ |
| **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞** | `statuscode === 0` | –§–ª–∞–≥ `fromCache` |
| **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö** | –¢–æ–ª—å–∫–æ HTTP –æ—Ç–≤–µ—Ç—ã | –õ—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ |
| **–ü–µ—Ä–µ–¥–∞—á–∞ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ (hits, misses, size) |
| **LRU –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ** | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ | ‚úÖ –†—É—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ‚ö° –í—ã—Å–æ–∫–∞—è | ‚ö° –°—Ä–µ–¥–Ω—è—è |
| **–ì–∏–±–∫–æ—Å—Ç—å** | ‚≠ê‚≠ê –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è | ‚≠ê‚≠ê‚≠ê –ü–æ–ª–Ω–∞—è |
| **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏ |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π HTTP –∫—ç—à –∫–æ–≥–¥–∞:**
- ‚úÖ –ö—ç—à–∏—Ä—É–µ—Ç–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ API
- ‚úÖ –ù—É–∂–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- ‚úÖ –ù–µ –Ω—É–∂–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ –ù–µ –Ω—É–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–ª–æ—è–º–∏

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Custom –∫—ç—à –∫–æ–≥–¥–∞:**
- ‚úÖ –ù—É–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É route handlers
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- ‚úÖ –ù—É–∂–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ-HTTP –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–∂–Ω–æ –ª–∏ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å?

**–î–∞!** –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–∞ –ø–æ–¥—Ö–æ–¥–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

```javascript
// –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π HTTP –∫—ç—à –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
http.request(url, {
  caching: true,
  cacheTime: 300000
}, function(error, response) {
  var data = JSON.parse(response.toString());
  
  // Custom –∫—ç—à –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  var processed = processData(data);
  customCache.set('processed:' + key, processed);
});
```



---

## –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π

```javascript
function loader() {
  console.log('Loading page:', currentPage);
  
  apiClient.getCatalog(currentPage, function(error, items, fromCache) {
    // 1. –°–±—Ä–æ—Å–∏—Ç—å loading
    page.loading = false;
    
    // 2. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É
    if (error) {
      console.error('Error:', error);
      page.haveMore(false);
      return;  // ‚ö†Ô∏è –í–ê–ñ–ù–û: –≤—ã—Ö–æ–¥ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
    }
    
    // 3. –î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã
    items.forEach(function(item) {
      page.appendItem(item.url, 'video', {
        title: item.title,
        icon: item.icon
      });
    });
    
    // 4. –£–≤–µ–ª–∏—á–∏—Ç—å —Å—á—ë—Ç—á–∏–∫
    currentPage++;
    
    // 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
    if (items.endOfData) {
      page.haveMore(false);
    } else {
      page.haveMore(true);
    }
  });
}
```

### ‚ùå –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

**–û—à–∏–±–∫–∞ 1: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ return –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏**
```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
if (error) {
  page.haveMore(false);
  // –ö–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è!
}
items.forEach(...);  // –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
```

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
if (error) {
  page.haveMore(false);
  return;  // –í—ã—Ö–æ–¥ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
}
items.forEach(...);  // –ù–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
```

**–û—à–∏–±–∫–∞ 2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π**
```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
page.haveMore(true);      // –°–Ω–∞—á–∞–ª–∞
items.forEach(...);       // –ü–æ—Ç–æ–º
currentPage++;
```

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
items.forEach(...);       // –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—è–µ–º
currentPage++;            // –ü–æ—Ç–æ–º —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º
page.haveMore(true);      // –ü–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä—è–µ–º
```

**–û—à–∏–±–∫–∞ 3: page.loading –≤ –∫–æ–Ω—Ü–µ**
```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
apiClient.getCatalog(currentPage, function(error, items) {
  // ... –∫–æ–¥ ...
  page.loading = false;  // –í –∫–æ–Ω—Ü–µ
});
```

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
apiClient.getCatalog(currentPage, function(error, items) {
  page.loading = false;  // –í –Ω–∞—á–∞–ª–µ callback
  // ... –∫–æ–¥ ...
});
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫—ç—à–∞ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ

–ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∫—ç—à–µ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. `page.flush()` –æ—á–∏—â–∞–µ—Ç –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
2. –î–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
3. `page.asyncPaginator` –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### –†–µ—à–µ–Ω–∏–µ: –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫—ç—à–∞

```javascript
function loader() {
  apiClient.getCatalog(currentPage, function(error, items, fromCache) {
    page.loading = false;
    
    if (error) {
      page.haveMore(false);
      return;
    }
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    items.forEach(function(item) {
      page.appendItem(item.url, 'video', {
        title: item.title
      });
    });
    
    currentPage++;
    
    if (items.endOfData) {
      page.haveMore(false);
    } else {
      page.haveMore(true);
      
      // ‚úÖ –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –∏–∑ –∫—ç—à–∞
      if (fromCache && currentPage <= 3) {
        console.log('Auto-loading page', currentPage, 'from cache');
        setTimeout(function() {
          loader();
        }, 10);  // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è UI
      }
    }
  });
}
```

### –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü–µ—Ä–≤–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ (–±–µ–∑ –∫—ç—à–∞):**
```
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 ‚Üí HTTP –∑–∞–ø—Ä–æ—Å ‚Üí fromCache=false ‚Üí –ù–ï–¢ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫—Ä–æ–ª–ª–∏—Ç ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 2
```

**–í–æ–∑–≤—Ä–∞—Ç (—Å –∫—ç—à–µ–º):**
```
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 ‚Üí –ö—ç—à ‚Üí fromCache=true ‚Üí –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã 2
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 2 ‚Üí –ö—ç—à ‚Üí fromCache=true ‚Üí –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã 3
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 3 ‚Üí –ö—ç—à ‚Üí fromCache=true ‚Üí –°—Ç–æ–ø (currentPage > 3)
–†–µ–∑—É–ª—å—Ç–∞—Ç: 60 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–º–µ—Å—Ç–æ 20
```

---

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –í—ã–±–æ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

**–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π HTTP –∫—ç—à (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```javascript
// ‚úÖ –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤
http.request(url, {
  caching: true,
  cacheTime: 300000
}, callback);
```

**Custom –∫—ç—à (—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏):**
```javascript
// ‚úÖ –î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–ª–æ—è–º–∏
cache.set('anime:' + id + ':metadata', metadata);
```

### 2. –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –∫—ç—à–∞

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –í–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
var cacheKey = url + ':' + JSON.stringify(params);

// –ü—Ä–∏–º–µ—Ä—ã:
// "https://api.com/catalog?page=1"
// "https://api.com/catalog?page=2"
// "https://api.com/search:{"query":"anime"}"
```

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –û–¥–∏–Ω –∫–ª—é—á –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
var cacheKey = 'catalog';  // –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞
```

### 3. –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å RAW –¥–∞–Ω–Ω—ã–µ

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ö—ç—à–∏—Ä—É–µ–º RAW –¥–∞–Ω–Ω—ã–µ –æ—Ç API
cache.set(cacheKey, rawData);

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–∞–∂–¥—ã–π —Ä–∞–∑
var processedItems = processData(rawData);
callback(null, processedItems);
```

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ö—ç—à–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
var processedItems = processData(rawData);
cache.set(cacheKey, processedItems);  // –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É
```

**–ü–æ—á–µ–º—É RAW –¥–∞–Ω–Ω—ã–µ:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è (–Ω–æ–≤—ã–µ –ø–æ–ª—è, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- RAW –¥–∞–Ω–Ω—ã–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ü–µ–ª–µ–π

### 4. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –∏–∑ –∫—ç—à–∞

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
if (cachedData !== null) {
  setTimeout(function() {
    callback(null, cachedData, true);
  }, 0);
  return;
}
```

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
if (cachedData !== null) {
  callback(null, cachedData, true);  // –ú–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å UI
  return;
}
```

**–ü–æ—á–µ–º—É setTimeout(0):**
- –î–∞—ë—Ç Movian –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É UI
- –î–µ–ª–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ü–µ—Ä–µ–¥–∞—ë–º —Ñ–ª–∞–≥ fromCache
callback(null, data, true);   // –ò–∑ –∫—ç—à–∞
callback(null, data, false);  // –ò–∑ HTTP
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –∏–∑ –∫—ç—à–∞
- –û—Ç–ª–∞–¥–∫–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (—Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏)

### 6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ 3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã
if (fromCache && currentPage <= 3) {
  setTimeout(loader, 10);
}
```

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
if (fromCache) {
  setTimeout(loader, 10);  // –ú–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
}
```

**–ü–æ—á–µ–º—É –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:**
- –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É UX –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- –ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç UI
- –≠–∫–æ–Ω–æ–º–∏—Ç –ø–∞–º—è—Ç—å

### 7. –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ó–∞–¥–µ—Ä–∂–∫–∞ 10-50ms
setTimeout(function() {
  loader();
}, 10);
```

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ë–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏
loader();  // –ú–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å UI
```

### 8. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```javascript
function loader() {
  console.log('[PAGINATION] Loading page:', currentPage);
  
  apiClient.getCatalog(currentPage, function(error, items, fromCache) {
    console.log('[PAGINATION] Loaded', items.length, 'items');
    console.log('[PAGINATION] fromCache:', fromCache);
    console.log('[PAGINATION] endOfData:', items.endOfData);
    
    // ... –∫–æ–¥ ...
  });
}
```

### 9. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ endOfData

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º metadata –æ—Ç API
if (data.meta && data.meta.pagination) {
  items.endOfData = data.meta.pagination.current_page >= data.meta.pagination.total_pages;
} else {
  // Fallback
  items.endOfData = data.items.length < PAGE_SIZE;
}
```

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –¢–æ–ª—å–∫–æ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤
items.endOfData = data.items.length < PAGE_SIZE;
// –ü—Ä–æ–±–ª–µ–º–∞: –ï—Å–ª–∏ API –≤–µ—Ä–Ω—É–ª –º–µ–Ω—å—à–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤, endOfData –±—É–¥–µ—Ç true
```

---

## –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

### –û—à–∏–±–∫–∞ 1: –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å—á—ë—Ç—á–∏–∫ —Å—Ç—Ä–∞–Ω–∏—Ü

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
var currentPage = 1;

new page.Route('plugin:catalog', function(page) {
  // currentPage –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ
  function loader() {
    // ...
  }
});
```

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –õ–æ–∫–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
new page.Route('plugin:catalog', function(page) {
  var currentPage = 1;  // –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—Ö–æ–¥–µ
  
  function loader() {
    // ...
  }
});
```

### –û—à–∏–±–∫–∞ 2: –ó–∞–±—ã–ª–∏ page.flush()

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ë–µ–∑ page.flush()
new page.Route('plugin:catalog', function(page) {
  var currentPage = 1;
  // –°—Ç–∞—Ä—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  
  loader();
  page.asyncPaginator = loader;
});
```

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –° page.flush()
new page.Route('plugin:catalog', function(page) {
  var currentPage = 1;
  page.flush();  // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
  
  loader();
  page.asyncPaginator = loader;
});
```

### –û—à–∏–±–∫–∞ 3: –ù–µ –≤—ã–∑–≤–∞–ª–∏ loader() –ø–µ—Ä–≤—ã–π —Ä–∞–∑

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –¢–æ–ª—å–∫–æ asyncPaginator
new page.Route('plugin:catalog', function(page) {
  function loader() {
    // ...
  }
  
  page.asyncPaginator = loader;  // –ù–µ –≤—ã–∑–æ–≤–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
});
```

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤ + asyncPaginator
new page.Route('plugin:catalog', function(page) {
  function loader() {
    // ...
  }
  
  loader();  // –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤
  page.asyncPaginator = loader;  // –î–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
});
```

### –û—à–∏–±–∫–∞ 4: –ö—ç—à –±–µ–∑ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –û–¥–∏–Ω –∫–ª—é—á –¥–ª—è –≤—Å–µ—Ö
var cacheKey = 'catalog';
cache.set(cacheKey, data);  // –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2 –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É 1
```

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
var cacheKey = 'catalog:page:' + pageNum;
cache.set(cacheKey, data);
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è –±–µ–∑ –∫—ç—à–∞

```javascript
var page = require('movian/page');
var http = require('movian/http');

new page.Route('plugin:catalog', function(page) {
  page.type = "directory";
  page.metadata.title = "Catalog";
  
  var currentPage = 1;
  page.flush();
  
  function loader() {
    var url = 'https://api.example.com/items?page=' + currentPage;
    
    http.request(url, {}, function(error, response) {
      page.loading = false;
      
      if (error) {
        page.appendItem('', 'separator', {
          title: 'Error: ' + error
        });
        page.haveMore(false);
        return;
      }
      
      var data = JSON.parse(response.toString());
      
      data.items.forEach(function(item) {
        page.appendItem('plugin:item:' + item.id, 'video', {
          title: item.title,
          icon: item.poster
        });
      });
      
      currentPage++;
      page.haveMore(currentPage <= data.totalPages);
    });
  }
  
  loader();
  page.asyncPaginator = loader;
});
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å –∫—ç—à–µ–º

```javascript
var page = require('movian/page');
var apiClient = require('./lib/api');  // –° –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

new page.Route('plugin:catalog', function(page) {
  page.type = "directory";
  page.metadata.title = "Catalog";
  
  var currentPage = 1;
  page.flush();
  
  function loader() {
    apiClient.getCatalog(currentPage, function(error, items, fromCache) {
      page.loading = false;
      
      if (error) {
        page.appendItem('', 'separator', {
          title: 'Error: ' + error
        });
        page.haveMore(false);
        return;
      }
      
      items.forEach(function(item) {
        page.appendItem(item.url, 'video', {
          title: item.title,
          icon: item.icon
        });
      });
      
      currentPage++;
      
      if (items.endOfData) {
        page.haveMore(false);
      } else {
        page.haveMore(true);
        
        // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫—ç—à–∞
        if (fromCache && currentPage <= 3) {
          setTimeout(function() {
            loader();
          }, 10);
        }
      }
    });
  }
  
  loader();
  page.asyncPaginator = loader;
});
```

### –ü—Ä–∏–º–µ—Ä 3: –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö

```javascript
var page = require('movian/page');
var apiClient = require('./lib/api');

function processItems(rawData) {
  return rawData.items.map(function(item) {
    return {
      id: item.id,
      url: 'plugin:item:' + item.id,
      title: item.name,
      description: truncate(item.description, 200),
      icon: getOptimizedImage(item.poster),
      year: item.year,
      rating: calculateRating(item.likes)
    };
  });
}

new page.Route('plugin:catalog', function(page) {
  page.type = "directory";
  page.metadata.title = "Catalog";
  
  var currentPage = 1;
  page.flush();
  
  function loader() {
    apiClient.getCatalog(currentPage, function(error, rawData, fromCache) {
      page.loading = false;
      
      if (error) {
        page.haveMore(false);
        return;
      }
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
      var items = processItems(rawData);
      
      items.forEach(function(item) {
        page.appendItem(item.url, 'video', {
          title: item.title,
          description: item.description,
          icon: item.icon,
          year: item.year,
          rating: item.rating
        });
      });
      
      currentPage++;
      
      var endOfData = rawData.pagination.current >= rawData.pagination.total;
      
      if (endOfData) {
        page.haveMore(false);
      } else {
        page.haveMore(true);
        
        if (fromCache && currentPage <= 3) {
          setTimeout(loader, 10);
        }
      }
    });
  }
  
  loader();
  page.asyncPaginator = loader;
});
```

---

## –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ü–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- [ ] –ö—ç—à –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- [ ] RAW –¥–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–∞–∂–¥—ã–π —Ä–∞–∑
- [ ] –§–ª–∞–≥ `fromCache` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ –≤—Å–µ —É—Ä–æ–≤–Ω–∏
- [ ] –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ (2-3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
- [ ] `page.loading = false` –≤ –Ω–∞—á–∞–ª–µ callback
- [ ] `return` –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–∫–∏
- [ ] –≠–ª–µ–º–µ–Ω—Ç—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ü–ï–†–ï–î `page.haveMore()`
- [ ] `currentPage++` –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- [ ] `page.flush()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—Ö–æ–¥–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
- [ ] `loader()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –≤—Ä—É—á–Ω—É—é
- [ ] `page.asyncPaginator = loader` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ
- [ ] `endOfData` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏ (10-50ms)
- [ ] –ö—ç—à –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:
- –£–ª—É—á—à–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç
- –°–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ API
- –£—Å–∫–æ—Ä—è–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –≠–∫–æ–Ω–æ–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫

–°–ª–µ–¥—É–π—Ç–µ —ç—Ç–æ–º—É —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É, –∏ –≤–∞—à –ø–ª–∞–≥–∏–Ω –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–æ –∏ –Ω–∞–¥—ë–∂–Ω–æ!

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä Movian: async_page_load](../movian/plugin_examples/async_page_load/)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Movian Page API](https://movian.tv/docs/)
- [–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø–ª–∞–≥–∏–Ω–∞ Anilibria.tv](./lib/)

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-11-14  
**–ê–≤—Ç–æ—Ä:** Anilibria.tv Plugin Team
